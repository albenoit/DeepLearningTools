<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <link rel="shortcut icon" href="../../../_static/logo_listic.png"/><!-- Generated with Sphinx 6.2.1 and Furo 2023.05.20 -->
        <title>deeplearningtools.helpers.distance_network - DeepLearningTools 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=e6660623a769aa55fea372102b9bf3151b292993" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #2E3440;
  --color-code-foreground: #d8dee9;
  --font-stack: Roboto, sans-serif;
  --font-stack--monospace: Open Sans, monospace;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<div class="announcement">
  <aside class="announcement-content">
     <em>Deeplearningtools is currently in development.</em> 
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">DeepLearningTools 0.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../../_static/main_light.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../../_static/main_dark.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">DeepLearningTools 0.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example.html">Examples and demonstrations</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../reference.html">Reference manual</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Reference manual</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../reference_index.html">DeepLearningTools package</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of DeepLearningTools package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../main_script.html">Main subpackage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../unit_test.html">Test script</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference_helpers.html">deeplearningtools.helpers subpackage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference_tools.html">deeplearningtools.tools subpackage</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute.html">Community involvement and contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../version.html">Release notes</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for deeplearningtools.helpers.distance_network</h1><div class="highlight"><pre>
<span></span><span class="c1"># ========================================</span>
<span class="c1"># FileName: distance_network.py</span>
<span class="c1"># Date: 29 june 2023 - 08:00</span>
<span class="c1"># Author: Alexandre Benoit</span>
<span class="c1"># Email: alexandre.benoit@univ-smb.fr</span>
<span class="c1"># GitHub: https://github.com/albenoit/DeepLearningTools</span>
<span class="c1"># Brief: A collection of distance metrics</span>
<span class="c1"># for DeepLearningTools.</span>
<span class="c1"># =========================================</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">cosine_distances</span>
<span class="kn">from</span> <span class="nn">deeplearningtools.helpers.alignment</span> <span class="kn">import</span> <span class="n">align_network</span>

<div class="viewcode-block" id="percentage_different_signs_gradients"><a class="viewcode-back" href="../../../reference_helpers.html#deeplearningtools.helpers.distance_network.percentage_different_signs_gradients">[docs]</a><span class="k">def</span> <span class="nf">percentage_different_signs_gradients</span><span class="p">(</span>
        <span class="n">first_network</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">second_network</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">use_align</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cost_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the amount or percentage of weights or gradients that go in the same direction.</span>
<span class="sd">    The higher the percentage, the greater the distance between two layers.</span>
<span class="sd">    Referenced from the paper &quot;CMFL: Mitigating Communication Overhead for Federated Learning&quot; (https://home.cse.ust.hk/~weiwa/papers/cmfl-icdcs19.pdf).</span>

<span class="sd">    The percentage of weights or gradients that go in the same direction can be computed using the following equation:</span>

<span class="sd">    .. math::</span>
<span class="sd">        e(u,\overline{u}) = \\frac{{1}}{{N}} \sum_{j=1}^{N} I(sign(u_{j}) = sign(\overline{u}_{j}))</span>

<span class="sd">    where:</span>

<span class="sd">        - :math:`u=&lt;u_1, u_2, ..., u_N&gt;` is the local update,</span>
<span class="sd">        - :math:`N` is number of model parameters,</span>
<span class="sd">        - :math:`I\\text{{sign}}(u_{j} = \overline{u}_{j})=1` if :math:`u_j` and :math:`\overline{u}_{j}` are the same sign, and :math:`0` otherwise.</span>

<span class="sd">    :param first_network: Network or list of layers.</span>
<span class="sd">    :param second_network: Network or list of layers.</span>
<span class="sd">    :param use_align: Boolean indicating whether to align the networks.</span>
<span class="sd">    :param cost_distance: String or function for pairwise computation of the cost matrix.</span>
<span class="sd">    :return: Array of pairwise percentage layer.</span>

<span class="sd">    Author: Youssouph Faye.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">use_align</span><span class="p">:</span>
        <span class="n">second_network</span><span class="p">,</span> <span class="n">alignment_costs</span> <span class="o">=</span> <span class="n">align_network</span><span class="p">(</span><span class="n">first_network</span><span class="p">,</span> <span class="n">second_network</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">cost_distance</span><span class="p">)</span>

    <span class="n">percentages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[(</span><span class="n">layer_a</span> <span class="o">*</span> <span class="n">layer_b</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
         <span class="k">for</span> <span class="n">layer_a</span><span class="p">,</span> <span class="n">layer_b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">first_network</span><span class="p">,</span> <span class="n">second_network</span><span class="p">)]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">percentages</span></div>

<div class="viewcode-block" id="deep_relative_trust"><a class="viewcode-back" href="../../../reference_helpers.html#deeplearningtools.helpers.distance_network.deep_relative_trust">[docs]</a><span class="k">def</span> <span class="nf">deep_relative_trust</span><span class="p">(</span>
        <span class="n">first_network</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">second_network</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">use_align</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cost_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">return_drt_product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the deep relative trust between two networks or list of layers.</span>

<span class="sd">    Referenced from the paper &quot;Deep Relative Trust&quot; (https://arxiv.org/abs/2002.03432).</span>

<span class="sd">    This criterion computes the absolute difference between the projected trust values for each weight pair from the two networks, and normalizes this sum by the product of the number of layers and the dimension of the layers.</span>
<span class="sd">    The deep relative trust between two networks or list of layers can be computed using the following equation:</span>

<span class="sd">    .. math::</span>
<span class="sd">        \\left| \\frac{{f(x) - \\tilde{f}(x)}}{{f(x)}} \\right| \leq \left(1 + \\frac{{|\Delta a|}}{{|a|}}\\right) \left(1 + \\frac{{|\Delta b|}}{{|b|}}\\right) - 1</span>

<span class="sd">    where:</span>

<span class="sd">        - :math:`f(x)` is the output of the first network or list of layers.</span>
<span class="sd">        - :math:`\\tilde{f}(x)` is the output of the second network or list of layers.</span>
<span class="sd">        - :math:`\Delta a` represents the perturbation in the parameter `a`.</span>
<span class="sd">        - :math:`\Delta b` represents the perturbation in the parameter `b`.</span>
<span class="sd">        - :math:`a` and :math:`b` are the original parameters.</span>

<span class="sd">    :param first_network: Network or list of layers.</span>
<span class="sd">    :param second_network: Network or list of layers.</span>
<span class="sd">    :param use_align: Boolean indicating whether to align the networks.</span>
<span class="sd">    :param cost_distance: String or function for pairwise computation of the cost matrix.</span>
<span class="sd">    :param return_drt_product: Boolean indicating whether to return the deep relative trust product.</span>
<span class="sd">    :return: Array of distances or deep relative trust product and distances.</span>

<span class="sd">    Author: Youssouph Faye.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">use_align</span><span class="p">:</span>
        <span class="n">second_network</span><span class="p">,</span> <span class="n">alignment_costs</span> <span class="o">=</span> <span class="n">align_network</span><span class="p">(</span><span class="n">first_network</span><span class="p">,</span> <span class="n">second_network</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">cost_distance</span><span class="p">)</span>

    <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">((</span><span class="n">layer_b</span> <span class="o">-</span> <span class="n">layer_a</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">layer_a</span><span class="p">)</span><span class="o">+</span><span class="mf">1e-8</span><span class="p">))</span>
         <span class="k">for</span> <span class="n">layer_a</span><span class="p">,</span> <span class="n">layer_b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">first_network</span><span class="p">,</span> <span class="n">second_network</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">return_drt_product</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">distances</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">distances</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">distances</span></div>

<div class="viewcode-block" id="deep_relative_trust_similarity"><a class="viewcode-back" href="../../../reference_helpers.html#deeplearningtools.helpers.distance_network.deep_relative_trust_similarity">[docs]</a><span class="k">def</span> <span class="nf">deep_relative_trust_similarity</span><span class="p">(</span><span class="n">network_weights</span><span class="p">):</span>
    <span class="n">nb_models</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">network_weights</span><span class="p">)</span>
    <span class="n">similarity_matrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nb_models</span><span class="p">,</span> <span class="n">nb_models</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_models</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_models</span><span class="p">):</span>
            <span class="n">sim</span><span class="o">=</span><span class="n">deep_relative_trust</span><span class="p">(</span><span class="n">first_network</span><span class="o">=</span><span class="n">network_weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                    <span class="n">second_network</span><span class="o">=</span><span class="n">network_weights</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                                    <span class="n">return_drt_product</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">similarity_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">sim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">similarity_matrix</span></div>
        
<div class="viewcode-block" id="euclidean_norm"><a class="viewcode-back" href="../../../reference_helpers.html#deeplearningtools.helpers.distance_network.euclidean_norm">[docs]</a><span class="k">def</span> <span class="nf">euclidean_norm</span><span class="p">(</span>
        <span class="n">first_network</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">second_network</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">use_align</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cost_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the Euclidean norm between two networks or list of layers.</span>

<span class="sd">    The Euclidean norm can be calculated using the following equation:</span>

<span class="sd">    .. math::</span>
<span class="sd">        ||w_b - w_a|| = \sqrt{\sum{(w_b - w_a)^2}}</span>

<span class="sd">    :param first_network: Network or list of layers.</span>
<span class="sd">    :param second_network: Network or list of layers.</span>
<span class="sd">    :param use_align: Boolean indicating whether to align the networks.</span>
<span class="sd">    :param cost_distance: String or function for pairwise computation of the cost matrix.</span>
<span class="sd">    :return: Array of Euclidean norm for each layer.</span>

<span class="sd">    Author: Youssouph Faye.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">use_align</span><span class="p">:</span>
        <span class="n">second_network</span><span class="p">,</span> <span class="n">alignment_costs</span><span class="p">,</span> <span class="n">unit_changes_per_layer</span> <span class="o">=</span> <span class="n">align_network</span><span class="p">(</span><span class="n">first_network</span><span class="p">,</span> <span class="n">second_network</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">cost_distance</span><span class="p">)</span>

    <span class="n">euclid_norm_layers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">layer_b</span> <span class="o">-</span> <span class="n">layer_a</span><span class="p">),</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">layer_a</span><span class="p">,</span> <span class="n">layer_b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">first_network</span><span class="p">,</span> <span class="n">second_network</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="k">return</span> <span class="n">euclid_norm_layers</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">use_align</span> <span class="k">else</span> <span class="p">(</span><span class="n">euclid_norm_layers</span><span class="p">,</span> <span class="n">alignment_costs</span><span class="p">,</span> <span class="n">unit_changes_per_layer</span><span class="p">)</span></div>

<div class="viewcode-block" id="cosine_similarity"><a class="viewcode-back" href="../../../reference_helpers.html#deeplearningtools.helpers.distance_network.cosine_similarity">[docs]</a><span class="k">def</span> <span class="nf">cosine_similarity</span><span class="p">(</span>
        <span class="n">first_network</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">second_network</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">use_align</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cost_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the pairwise cosine similarity between two networks or list of layers.</span>

<span class="sd">    Referred from the paper &quot;Flexible Clustered Federated Learning&quot; (https://arxiv.org/pdf/2108.09749.pdf).</span>
<span class="sd">    The cosine similarity is calculated as the cosine of the angle between the two weight vectors:</span>

<span class="sd">    .. math::</span>
<span class="sd">        {cosine\\_{similarity}} = \\frac{{w_a \\cdot w_b}}{{\\|w_a\\| \\cdot \\|w_b\\|}}</span>

<span class="sd">    where:</span>
<span class="sd">        </span>
<span class="sd">        -:math:`w_a \cdot w_b` denotes the weight vectors</span>
<span class="sd">    </span>
<span class="sd">    :param first_network: Network or list of layers.</span>
<span class="sd">    :param second_network: Network or list of layers.</span>
<span class="sd">    :param use_align: Boolean indicating whether to align the networks.</span>
<span class="sd">    :param cost_distance: String or function for pairwise computation of the cost matrix.</span>
<span class="sd">    :return: Array of pairwise cosine similarity for each layer.</span>

<span class="sd">    Author: Youssouph Faye.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">use_align</span><span class="p">:</span>
        <span class="n">second_network</span><span class="p">,</span> <span class="n">alignment_costs</span><span class="p">,</span> <span class="n">unit_changes_per_layer</span> <span class="o">=</span> <span class="n">align_network</span><span class="p">(</span><span class="n">first_network</span><span class="p">,</span> <span class="n">second_network</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">cost_distance</span><span class="p">)</span>

    <span class="n">cosine_similarity_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="n">layer_a</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">layer_b</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span>
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">layer_a</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">layer_b</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">layer_a</span><span class="p">,</span> <span class="n">layer_b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">first_network</span><span class="p">,</span> <span class="n">second_network</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="k">return</span> <span class="n">cosine_similarity_matrix</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">use_align</span> <span class="k">else</span> <span class="p">(</span><span class="n">cosine_similarity_matrix</span><span class="p">,</span> <span class="n">alignment_costs</span><span class="p">,</span> <span class="n">unit_changes_per_layer</span><span class="p">)</span></div>

<div class="viewcode-block" id="flatten"><a class="viewcode-back" href="../../../reference_helpers.html#deeplearningtools.helpers.distance_network.flatten">[docs]</a><span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">weights</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flatten a list of weights arrays into a single 1D array.</span>

<span class="sd">    :param weights: List of weights arrays.</span>
<span class="sd">    :return: Flattened array of weights.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">])</span></div>

<div class="viewcode-block" id="cosine_distance"><a class="viewcode-back" href="../../../reference_helpers.html#deeplearningtools.helpers.distance_network.cosine_distance">[docs]</a><span class="k">def</span> <span class="nf">cosine_distance</span><span class="p">(</span><span class="n">w_a</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">w_b</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the cosine distance between two sets of weights.</span>

<span class="sd">    The cosine distance between two sets of weights, w_a and w_b, can be calculated using the following equation:</span>

<span class="sd">    .. math::</span>
<span class="sd">        {cosine\\_{distance}} = 1 - {cosine\\_{similarity}}</span>

<span class="sd">    :param w_a: List of weight arrays for the first set.</span>
<span class="sd">    :param w_b: List of weight arrays for the second set.</span>
<span class="sd">    :return: Cosine distance between the two sets of weights.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">cosine_distances</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">flatten</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">[</span><span class="n">w_a</span><span class="p">,</span> <span class="n">w_b</span><span class="p">]]))[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="l2"><a class="viewcode-back" href="../../../reference_helpers.html#deeplearningtools.helpers.distance_network.l2">[docs]</a><span class="k">def</span> <span class="nf">l2</span><span class="p">(</span><span class="n">w_a</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">w_b</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the L2 distance between two arrays or vectors. </span>
<span class="sd">    </span>
<span class="sd">    The L2 distance, also known as the Euclidean distance, between two arrays (or vectors) is a measure of the distance between these two points in Euclidean space. </span>
<span class="sd">    Mathematically, the distance L2 between two arrays, x and y, of equal size, can be calculated as follows:</span>

<span class="sd">    .. math::</span>
<span class="sd">        L2_{distance} = \sqrt{\sum_{i=1}^{n} (x_i - y_i)^2}</span>

<span class="sd">    where:</span>

<span class="sd">        - :math:`x_i` and :math:`y_i` are the corresponding elements of arrays x and y,</span>

<span class="sd">    :param x: The first array.</span>
<span class="sd">    :type x: np.ndarray</span>

<span class="sd">    :param y: The second array.</span>
<span class="sd">    :type y: np.ndarray</span>

<span class="sd">    :return: The L2 distance.</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">flatten</span><span class="p">(</span><span class="n">w_a</span><span class="p">)</span> <span class="o">-</span> <span class="n">flatten</span><span class="p">(</span><span class="n">w_b</span><span class="p">),</span> <span class="mi">2</span><span class="p">)))</span></div>

<div class="viewcode-block" id="l1"><a class="viewcode-back" href="../../../reference_helpers.html#deeplearningtools.helpers.distance_network.l1">[docs]</a><span class="k">def</span> <span class="nf">l1</span><span class="p">(</span><span class="n">w_a</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">w_b</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the L1 distance between two arrays or vectors.</span>

<span class="sd">    The L1 distance, also known as the Manhattan distance or taxicab distance, between two arrays (or vectors) is a measure of the absolute difference between </span>
<span class="sd">    the corresponding elements of the arrays.</span>
<span class="sd">    Mathematically, the L1 distance between two arrays, x and y, of equal size, can be calculated as follows:</span>

<span class="sd">    .. math::</span>
<span class="sd">        L1_{distance} = \sum_{i=1}^{n} |x_i - y_i|</span>

<span class="sd">    where:</span>

<span class="sd">        - :math:`x_i` and :math:`y_i` are the corresponding elements of arrays x and y,</span>
<span class="sd">        </span>
<span class="sd">    :param x: The first array.</span>
<span class="sd">    :type x: np.ndarray</span>

<span class="sd">    :param y: The second array.</span>
<span class="sd">    :type y: np.ndarray</span>

<span class="sd">    :return: The L1 distance.</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">flatten</span><span class="p">(</span><span class="n">w_a</span><span class="p">)</span> <span class="o">-</span> <span class="n">flatten</span><span class="p">(</span><span class="n">w_b</span><span class="p">)))</span></div>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Alexandre Benoit
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    </body>
</html>